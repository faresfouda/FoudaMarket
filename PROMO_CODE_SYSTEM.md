# ูุธุงู ุฅุฏุงุฑุฉ ุฃููุงุฏ ุงูุฎุตู - Fouda Market

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ ูุธุงู ุฅุฏุงุฑุฉ ุฃููุงุฏ ุงูุฎุตู ุงููุงูู ูููุดุฑูุน ูุน ูุงุฌูุฉ ุฅุฏุงุฑูุฉ ูุชูุฏูุฉ ูููุฏูุฑูู ููุงุฌูุฉ ุนุฑุถ ูููุณุชุฎุฏููู. ุงููุธุงู ูุฏุนู ุฌููุน ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ ูุฅุฏุงุฑุฉ ุฃููุงุฏ ุงูุฎุตู ูุน ุงูุชุญูู ูู ุงูุตูุงุญูุฉ ูุงููููุฏ.

## ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

### ๐ ูุธุงู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

ุงููุธุงู ูุถูู ุฃู **ุงููุฏูุฑูู ููุท** ูููููู ุฅุฏุงุฑุฉ ุฃููุงุฏ ุงูุฎุตู:

#### 1. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู ุงูุฎุฏูุฉ
```dart
// ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุฏูุฑ
Future<bool> _isAdmin() async {
  try {
    final user = _auth.currentUser;
    if (user == null) return false;
    
    final userDoc = await _firestore.collection('users').doc(user.uid).get();
    if (!userDoc.exists) return false;
    
    final userData = userDoc.data()!;
    return userData['role'] == 'admin';
  } catch (e) {
    print('Error checking admin permissions: $e');
    return false;
  }
}
```

#### 2. ุญูุงูุฉ ุฌููุน ุงูุนูููุงุช ุงูุฅุฏุงุฑูุฉ
- โ **ุฅูุดุงุก ุฃููุงุฏ ุงูุฎุตู**: ุงููุฏูุฑ ููุท
- โ **ุชุญุฏูุซ ุฃููุงุฏ ุงูุฎุตู**: ุงููุฏูุฑ ููุท  
- โ **ุญุฐู ุฃููุงุฏ ุงูุฎุตู**: ุงููุฏูุฑ ููุท
- โ **ุชูุนูู/ุฅูุบุงุก ุชูุนูู**: ุงููุฏูุฑ ููุท
- โ **ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช**: ุงููุฏูุฑ ููุท

#### 3. ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงููุญููุฉ
```dart
// ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูุฏูุฑ
if (authState is! Authenticated || 
    authState.userProfile == null || 
    authState.userProfile!.role != 'admin') {
  return _buildUnauthorizedScreen();
}
```

#### 4. ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- "ุบูุฑ ูุตุฑุญ ูู ุจุฅูุดุงุก ุฃููุงุฏ ุงูุฎุตู. ูุฌุจ ุฃู ุชููู ูุฏูุฑุงู."
- "ุบูุฑ ูุตุฑุญ ูู ุจุชุญุฏูุซ ุฃููุงุฏ ุงูุฎุตู. ูุฌุจ ุฃู ุชููู ูุฏูุฑุงู."
- "ุบูุฑ ูุตุฑุญ ูู ุจุญุฐู ุฃููุงุฏ ุงูุฎุตู. ูุฌุจ ุฃู ุชููู ูุฏูุฑุงู."

### ๐ฅ ูุตูู ุงููุณุชุฎุฏููู ุงูุนุงุฏููู

ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูููููู:
- โ **ุนุฑุถ ุฃููุงุฏ ุงูุฎุตู ุงูุตุงูุญุฉ ููุท**
- โ **ุงุณุชุฎุฏุงู ุฃููุงุฏ ุงูุฎุตู ูู ุงูุทูุจุงุช**
- โ **ูุง ูููููู ุฅุฏุงุฑุฉ ุงูุฃููุงุฏ**

## ุงูููููุงุช ุงูุฑุฆูุณูุฉ

### 1. ูููุฐุฌ ุงูุจูุงูุงุช (Models)

#### `PromoCodeModel`
```dart
class PromoCodeModel {
  final String id;
  final String code;
  final String description;
  final double discountPercentage;
  final double? maxDiscountAmount; // ุงูุญุฏ ุงูุฃูุตู ููุฎุตู
  final double? minOrderAmount; // ุงูุญุฏ ุงูุฃุฏูู ููุทูุจ
  final int maxUsageCount; // ุนุฏุฏ ูุฑุงุช ุงูุงุณุชุฎุฏุงู ุงูุฃูุตู
  final int currentUsageCount; // ุนุฏุฏ ูุฑุงุช ุงูุงุณุชุฎุฏุงู ุงูุญุงูู
  final DateTime expiryDate;
  final bool isActive;
  final DateTime createdAt;
  final DateTime updatedAt;
  final String createdBy; // ูุนุฑู ุงููุฏูุฑ ุงูุฐู ุฃูุดุฃ ุงูููุฏ

  // ุฎุตุงุฆุต ูุญุณูุจุฉ
  bool get isExpired => DateTime.now().isAfter(expiryDate);
  bool get isUsageLimitReached => currentUsageCount >= maxUsageCount;
  bool get isValid => isActive && !isExpired && !isUsageLimitReached;
}
```

### 2. ุงูุฎุฏูุงุช (Services)

#### `PromoCodeService`
```dart
class PromoCodeService {
  // ุงูุนูููุงุช ุงูุฅุฏุงุฑูุฉ (ุงููุฏูุฑ ููุท)
  Future<void> createPromoCode(PromoCodeModel promoCode);
  Future<void> updatePromoCode(String promoCodeId, Map<String, dynamic> data);
  Future<void> deletePromoCode(String promoCodeId);
  Future<void> togglePromoCodeStatus(String promoCodeId, bool isActive);
  
  // ุงูุนูููุงุช ุงูุนุงูุฉ
  Future<List<PromoCodeModel>> getAllPromoCodes(); // ูููุฏูุฑูู
  Future<List<PromoCodeModel>> getValidPromoCodes(); // ูููุณุชุฎุฏููู
  Future<PromoCodeModel?> getPromoCodeByCode(String code);
  Future<Map<String, dynamic>> validatePromoCode(String code, double orderAmount);
  Future<Map<String, dynamic>> getPromoCodeStats(); // ูููุฏูุฑูู
}
```

### 3. ุฅุฏุงุฑุฉ ุงูุญุงูุฉ (State Management)

#### Events
```dart
// ุงูุฃุญุฏุงุซ ุงูุฅุฏุงุฑูุฉ
class CreatePromoCode extends PromoCodeEvent;
class UpdatePromoCode extends PromoCodeEvent;
class DeletePromoCode extends PromoCodeEvent;
class TogglePromoCodeStatus extends PromoCodeEvent;
class LoadPromoCodeStats extends PromoCodeEvent;

// ุงูุฃุญุฏุงุซ ุงูุนุงูุฉ
class LoadPromoCodes extends PromoCodeEvent; // ูููุฏูุฑูู
class LoadValidPromoCodes extends PromoCodeEvent; // ูููุณุชุฎุฏููู
class ValidatePromoCode extends PromoCodeEvent;
```

#### States
```dart
class PromoCodeInitial extends PromoCodeState;
class PromoCodeLoading extends PromoCodeState;
class PromoCodesLoaded extends PromoCodeState;
class PromoCodeCreated extends PromoCodeState;
class PromoCodeUpdated extends PromoCodeState;
class PromoCodeDeleted extends PromoCodeState;
class PromoCodeError extends PromoCodeState;
class PromoCodeEmpty extends PromoCodeState;
```

### 4. ูุงุฌูุงุช ุงููุณุชุฎุฏู (UI)

#### ุดุงุดุฉ ุฅุฏุงุฑุฉ ุฃููุงุฏ ุงูุฎุตู (ุงููุฏูุฑูู)
- `lib/views/admin/promo_codes_screen.dart`
- ุนุฑุถ ุฌููุน ุงูุฃููุงุฏ ูุน ุฅุญุตุงุฆูุงุช
- ุฅููุงููุฉ ุงูุฅุถุงูุฉ ูุงูุชุนุฏูู ูุงูุญุฐู
- ุชูุนูู/ุฅูุบุงุก ุชูุนูู ุงูุฃููุงุฏ

#### ุดุงุดุฉ ุฅุถุงูุฉ/ุชุนุฏูู ููุฏ ุงูุฎุตู (ุงููุฏูุฑูู)
- `lib/views/admin/add_edit_promo_code_screen.dart`
- ูููุฐุฌ ุดุงูู ูุฅูุดุงุก ูุชุนุฏูู ุงูุฃููุงุฏ
- ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- ุฎูุงุฑุงุช ูุชูุฏูุฉ (ุญุฏูุฏ ุงูุฎุตู ูุงูุทูุจ)

#### ุดุงุดุฉ ุนุฑุถ ุฃููุงุฏ ุงูุฎุตู (ุงููุณุชุฎุฏููู)
- `lib/views/profile/promo_code_screen.dart`
- ุนุฑุถ ุงูุฃููุงุฏ ุงูุตุงูุญุฉ ููุท
- ูุนูููุงุช ููุตูุฉ ุนู ูู ููุฏ
- ูุง ุชูุฌุฏ ุฅููุงููุฉ ุชุนุฏูู

## ุงูููุฒุงุช ุงููุชูุฏูุฉ

### 1. ุงูุชุญูู ูู ุงูุตูุงุญูุฉ
```dart
Future<Map<String, dynamic>> validatePromoCode(String code, double orderAmount) {
  // ุงูุชุญูู ูู ูุฌูุฏ ุงูููุฏ
  // ุงูุชุญูู ูู ุงูุชูุนูู
  // ุงูุชุญูู ูู ุงูุชูุงุก ุงูุตูุงุญูุฉ
  // ุงูุชุญูู ูู ุญุฏ ุงูุงุณุชุฎุฏุงู
  // ุงูุชุญูู ูู ุงูุญุฏ ุงูุฃุฏูู ููุทูุจ
  // ุญุณุงุจ ูููุฉ ุงูุฎุตู
}
```

### 2. ุงูุฅุญุตุงุฆูุงุช ุงููุชูุฏูุฉ
- ุฅุฌูุงูู ุนุฏุฏ ุงูุฃููุงุฏ
- ุนุฏุฏ ุงูุฃููุงุฏ ุงูููุนูุฉ
- ุนุฏุฏ ุงูุฃููุงุฏ ุงูููุชููุฉ ุงูุตูุงุญูุฉ
- ุฅุฌูุงูู ูุฑุงุช ุงูุงุณุชุฎุฏุงู
- ุงูุฃููุงุฏ ุงูุชู ูุตูุช ููุญุฏ ุงูุฃูุตู

### 3. ุฎูุงุฑุงุช ูุชูุฏูุฉ ููุฃููุงุฏ
- **ุงูุญุฏ ุงูุฃูุตู ููุฎุตู**: ููุน ุงูุฎุตู ูู ุชุฌุงูุฒ ูููุฉ ูุนููุฉ
- **ุงูุญุฏ ุงูุฃุฏูู ููุทูุจ**: ุชุทุจูู ุงูููุฏ ุนูู ุทูุจุงุช ุจูููุฉ ูุนููุฉ
- **ุนุฏุฏ ูุฑุงุช ุงูุงุณุชุฎุฏุงู**: ุชุญุฏูุฏ ุนุฏุฏ ุงููุฑุงุช ุงููุณููุญ ุจูุง
- **ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ**: ุชุญุฏูุฏ ูุฏุฉ ุตูุงุญูุฉ ุงูููุฏ

## ุงูุฃูุงู ูุงูุญูุงูุฉ

### 1. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- ูู ุนูููุฉ ุฅุฏุงุฑูุฉ ุชุชุญูู ูู ุฏูุฑ ุงููุณุชุฎุฏู
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏููู ุบูุฑ ุงููุตุฑุญ ููู
- ุญูุงูุฉ ุนูู ูุณุชูู ุงูุฎุฏูุฉ ูุงููุงุฌูุฉ

### 2. ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- ุงูุชุญูู ูู ุนุฏู ุชูุฑุงุฑ ููุฏ ุงูุฎุตู
- ุงูุชุญูู ูู ุตุญุฉ ุงููุณุจ ุงููุฆููุฉ
- ุงูุชุญูู ูู ุตุญุฉ ุงูุชูุงุฑูุฎ
- ุงูุชุญูู ูู ุตุญุฉ ุงูููู ุงูุฑูููุฉ

### 3. ุชุชุจุน ุงูุนูููุงุช
- ุชุณุฌูู ูุนุฑู ุงููุฏูุฑ ุงูุฐู ุฃูุดุฃ ูู ููุฏ
- ุชุณุฌูู ุชุงุฑูุฎ ุงูุฅูุดุงุก ูุงูุชุญุฏูุซ
- ุชุชุจุน ุนุฏุฏ ูุฑุงุช ุงูุงุณุชุฎุฏุงู

## ุงูุงุณุชุฎุฏุงู

### ูููุฏูุฑูู
1. ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจ ูุฏูุฑ
2. ุงูุงูุชูุงู ุฅูู "ุฅุฏุงุฑุฉ ุฃููุงุฏ ุงูุฎุตู"
3. ุฅุถุงูุฉ ุฃููุงุฏ ุฎุตู ุฌุฏูุฏุฉ
4. ุชุนุฏูู ุฃู ุญุฐู ุงูุฃููุงุฏ ุงูููุฌูุฏุฉ
5. ูุฑุงูุจุฉ ุงูุฅุญุตุงุฆูุงุช

### ูููุณุชุฎุฏููู
1. ุงูุงูุชูุงู ุฅูู "ุฃููุงุฏ ุงูุฎุตู"
2. ุนุฑุถ ุงูุฃููุงุฏ ุงูุตุงูุญุฉ
3. ุงุณุชุฎุฏุงู ุงูุฃููุงุฏ ูู ุงูุทูุจุงุช
4. ูุฑุงูุจุฉ ุญุงูุฉ ุงูุฃููุงุฏ

## ุงูุชุทููุฑ ุงููุณุชูุจูู

### ุงูููุฒุงุช ุงูููุชุฑุญุฉ
- [ ] ูุธุงู ุฃููุงุฏ ุงูุฎุตู ุงููุคูุชุฉ
- [ ] ุฃููุงุฏ ุฎุตู ุฎุงุตุฉ ุจูุฆุงุช ูุนููุฉ
- [ ] ูุธุงู ููุงุท ุงูููุงุก
- [ ] ุชูุงุฑูุฑ ููุตูุฉ ุนู ุงุณุชุฎุฏุงู ุงูุฃููุงุฏ
- [ ] ุฅุดุนุงุฑุงุช ูููุฏูุฑูู ุนูุฏ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฃููุงุฏ
- [ ] ูุธุงู ุฃููุงุฏ ุงูุฎุตู ุงูุชููุงุฆูุฉ

### ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ
- [ ] ุชุญุณูู ุฃุฏุงุก ุงูุงุณุชุนูุงูุงุช
- [ ] ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุชุญูู ูู ุงูุตุญุฉ
- [ ] ุชุญุณูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
- [ ] ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุฅุญุตุงุฆูุงุช
- [ ] ูุธุงู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู

## ุงูุฎูุงุตุฉ

ูุธุงู ุฃููุงุฏ ุงูุฎุตู ูู Fouda Market ูููุฑ:
- โ **ุชุญูู ูุงูู ูููุฏูุฑูู** ูู ุฅุฏุงุฑุฉ ุงูุฃููุงุฏ
- โ **ุญูุงูุฉ ุดุงููุฉ** ูู ุงููุตูู ุบูุฑ ุงููุตุฑุญ
- โ **ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู** ูููุฏูุฑูู ูุงููุณุชุฎุฏููู
- โ **ููุฒุงุช ูุชูุฏูุฉ** ููุชุญูู ูู ุงูุฃููุงุฏ
- โ **ุฃูุงู ุนุงูู** ูุน ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- โ **ูุฑููุฉ ูู ุงูุชุฎุตูุต** ูุน ุงูุฎูุงุฑุงุช ุงููุชูุฏูุฉ

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ููููุฑ ุชุฌุฑุจุฉ ููุชุงุฒุฉ ูุฅุฏุงุฑุฉ ุฃููุงุฏ ุงูุฎุตู ูุน ุถูุงู ุงูุฃูุงู ูุงูุชุญูู ุงููุงูู ูููุฏูุฑูู. 