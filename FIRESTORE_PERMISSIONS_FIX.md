# ุฅุตูุงุญ ูุดููุฉ ุตูุงุญูุงุช Firestore ูููุฑุงุฌุนุงุช - ูุญุฏุซ

## ๐จ ุงููุดููุฉ

```
W/Firestore(23434): (25.1.4) [Firestore]: Write failed at reviews/FbK7RpcW8Za7eHZXxWCg: Status{code=PERMISSION_DENIED, description=Missing or insufficient permissions., cause=null}
```

## ๐ ุชุญููู ุงููุดููุฉ

### โ ุงูููุงุนุฏ ุงูุญุงููุฉ ุตุญูุญุฉ:
ุงูููุงุนุฏ ุงูููุฌูุฏุฉ ูู `firestore.rules` ุตุญูุญุฉ ูุชุณูุญ ูููุณุชุฎุฏููู ุจุฅูุดุงุก ูุฑุงุฌุนุงุช. ุงููุดููุฉ ุนูู ุงูุฃุฑุฌุญ ูู:

1. **ุงููุณุชุฎุฏู ููุณ ูุฏูู ุฏูุฑ ูุญุฏุฏ** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. **ุจูุงูุงุช ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏุฉ** ูู ูุฌููุนุฉ `users`
3. **ุญูู `role` ููููุฏ** ูู ุจูุงูุงุช ุงููุณุชุฎุฏู

## ๐๏ธ ุงูุญููู

### ุงูุญู 1: ุงูุชุญูู ูู ุจูุงูุงุช ุงููุณุชุฎุฏู (ุงูุฃูู)

#### 1.1 ูุชุญ Firebase Console:
```
https://console.firebase.google.com
```

#### 1.2 ุงูุงูุชูุงู ุฅูู Firestore:
- ุงุฎุชุฑ ูุดุฑูุนู
- ุงุฐูุจ ุฅูู Firestore Database
- ุงูุชุญ ูุฌููุนุฉ `users`
- ุงุจุญุซ ุนู ุงููุณุชุฎุฏู ุงูุญุงูู (ุงุณุชุฎุฏู UID ูู ุฑุณุงุฆู ุงูุชุดุฎูุต)

#### 1.3 ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุทููุจุฉ:
```json
{
  "id": "user_uid_here",
  "email": "user@example.com",
  "name": "ุงุณู ุงููุณุชุฎุฏู",
  "phone": "ุฑูู ุงููุงุชู",
  "role": "user", // โ๏ธ ูุฐุง ุงูุญูู ูุทููุจ!
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

#### 1.4 ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ:
ุฃุถู ุงููุณุชุฎุฏู ูุฏููุงู ูู ูุฌููุนุฉ `users`:
```json
{
  "id": "user_uid_from_debug",
  "email": "user@example.com",
  "name": "ุงุณู ุงููุณุชุฎุฏู",
  "phone": "ุฑูู ุงููุงุชู",
  "role": "user",
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z"
}
```

#### 1.5 ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ููุฌูุฏ ููู ุจุฏูู ุฏูุฑ:
ุฃุถู ุญูู `role`:
```json
{
  "role": "user"
}
```

---

### ุงูุญู 2: ุฅุถุงูุฉ ุชุณุฌูู ููุชุดุฎูุต (ุชู ุชุทุจููู)

ุชู ุฅุถุงูุฉ ุชุณุฌูู ูู `add_review_screen.dart`:
```dart
print('=== Review Debug Info ===');
print('User ID: ${user.uid}');
print('User data: $userData');
print('User role: ${userData?['role']}');
print('Review data: ${review.toJson()}');
print('========================');
```

#### 2.1 ููููุฉ ูุฑุงุกุฉ ุงูุฑุณุงุฆู:
1. ุงูุชุญ Android Studio / VS Code
2. ุงุฐูุจ ุฅูู Console / Debug Console
3. ุงุจุญุซ ุนู ุฑุณุงุฆู "Review Debug Info"
4. ุงูุณุฎ `User ID` ู `User role`

---

### ุงูุญู 3: ุฅุตูุงุญ ููุงุนุฏ ูุจุณุทุฉ (ููุงุฎุชุจุงุฑ ุงูุณุฑูุน)

ุฅุฐุง ููุช ุชุฑูุฏ ุงุฎุชุจุงุฑ ุณุฑูุนุ ุงุณุชุฎุฏู ูุฐู ุงูููุงุนุฏ ุงููุคูุชุฉ:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Reviews collection - TEMPORARY RULES FOR TESTING
    match /reviews/{reviewId} {
      // ุงูุณูุงุญ ุจูู ุดูุก ูููุณุชุฎุฏููู ุงููุณุฌููู (ููุงุฎุชุจุงุฑ ููุท)
      allow read, write: if request.auth != null;
    }
    
    // ุจุงูู ุงูููุงุนุฏ ููุง ูู...
  }
}
```

โ๏ธ **ุชุญุฐูุฑ**: ูุง ุชุณุชุฎุฏู ูุฐู ุงูููุงุนุฏ ูู ุงูุฅูุชุงุฌ!

---

## ๐ง ุฎุทูุงุช ุงูุชุดุฎูุต ุงูููุตูุฉ

### ุงูุฎุทูุฉ 1: ุชุดุบูู ุงูุชุทุจูู ูุน ุงูุชุณุฌูู
1. ุงูุชุญ ุงูุชุทุจูู
2. ุณุฌู ุฏุฎูู
3. ุญุงูู ุฅูุดุงุก ูุฑุงุฌุนุฉ
4. ุงูุธุฑ ุฅูู ุฑุณุงุฆู ุงูุชุดุฎูุต ูู Console

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู Firebase Console
1. ุงูุชุญ Firebase Console
2. ุงุฐูุจ ุฅูู Firestore Database
3. ุงุจุญุซ ุนู ุงููุณุชุฎุฏู ุจุงุณุชุฎุฏุงู UID ูู ุงูุฎุทูุฉ 1
4. ุชุญูู ูู ูุฌูุฏ ุญูู `role`

### ุงูุฎุทูุฉ 3: ุฅุตูุงุญ ุงูุจูุงูุงุช
ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ ุฃู ุจุฏูู ุฏูุฑ:
1. ุฃุถู ุงููุณุชุฎุฏู ูุฏููุงู
2. ุชุฃูุฏ ูู ูุฌูุฏ ุญูู `role: "user"`
3. ุฌุฑุจ ุฅูุดุงุก ูุฑุงุฌุนุฉ ูุฑุฉ ุฃุฎุฑู

---

## ๐ ูุงุฆูุฉ ุงูุชุญูู ุงูุณุฑูุนุฉ

### โ ูุจู ุงูุงุฎุชุจุงุฑ:
- [ ] ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู
- [ ] ุจูุงูุงุช ุงููุณุชุฎุฏู ููุฌูุฏุฉ ูู ูุฌููุนุฉ `users`
- [ ] ุญูู `role` ููุฌูุฏ ููุณุงูู `"user"`
- [ ] ููุงุนุฏ Firestore ูุญุฏุซุฉ
- [ ] ุชุณุฌูู ุงูุชุดุฎูุต ููุนู

### โ ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ:
- [ ] ุฑุณุงุฆู ุงูุชุดุฎูุต ุชุธูุฑ ูู Console
- [ ] `User ID` ููุฌูุฏ
- [ ] `User role` ูุณุงูู `"user"`
- [ ] `Review data` ูุญุชูู ุนูู `user_id` ุตุญูุญ

### โ ุจุนุฏ ุงูุฅุตูุงุญ:
- [ ] ุฅูุดุงุก ูุฑุงุฌุนุฉ ุฌุฏูุฏุฉ ูุนูู
- [ ] ูุฑุงุกุฉ ุงููุฑุงุฌุนุงุช ูุนูู
- [ ] ุชุญุฏูุซ ุงููุฑุงุฌุนุงุช ูุนูู
- [ ] ุญุฐู ุงููุฑุงุฌุนุงุช ูุนูู (ูููุฏูุฑูู)

---

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ุงูุญููู:
- โ **ุฅูุดุงุก ุงููุฑุงุฌุนุงุช**: ูุนูู ูููุณุชุฎุฏููู ุงููุณุฌููู
- โ **ูุฑุงุกุฉ ุงููุฑุงุฌุนุงุช**: ูุนูู ุญุณุจ ุงูุตูุงุญูุงุช
- โ **ุชุญุฏูุซ ุงููุฑุงุฌุนุงุช**: ูุนูู ูุตุงุญุจ ุงููุฑุงุฌุนุฉ ูุงููุฏูุฑูู
- โ **ุญุฐู ุงููุฑุงุฌุนุงุช**: ูุนูู ูููุฏูุฑูู ููุท

---

## ๐ ุงูุฏุนู ุงูุณุฑูุน

### ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:

1. **ุงูุณุฎ ุฑุณุงุฆู ุงูุชุดุฎูุต** ูู Console
2. **ุชุญูู ูู Firebase Console** - ูุฌููุนุฉ `users`
3. **ุชุฃูุฏ ูู ูุฌูุฏ ุญูู `role`**
4. **ุฌุฑุจ ูุน ูุณุชุฎุฏู ุฌุฏูุฏ** ูุฏูู ุฏูุฑ ูุญุฏุฏ

### ุฑุณุงุฆู ุงูุชุดุฎูุต ุงููุชููุนุฉ:
```
=== Review Debug Info ===
User ID: abc123def456
User data: {id: abc123def456, name: ุฃุญูุฏ, role: user, ...}
User role: user
Review data: {user_id: abc123def456, ...}
========================
```

ุฅุฐุง ูุงู `User role: null` ุฃู ุบูุฑ ููุฌูุฏุ ููุฐู ูู ุงููุดููุฉ!

---

## ๐ฏ ุงูุญู ุงูุณุฑูุน

1. **ุงูุชุญ Firebase Console**
2. **ุงุฐูุจ ุฅูู Firestore Database**
3. **ุงุจุญุซ ุนู ุงููุณุชุฎุฏู ูู ูุฌููุนุฉ `users`**
4. **ุฃุถู ุญูู `role: "user"`**
5. **ุฌุฑุจ ุฅูุดุงุก ูุฑุงุฌุนุฉ ูุฑุฉ ุฃุฎุฑู**

ุงูุขู ูุฌุจ ุฃู ูุนูู ูุธุงู ุงููุฑุงุฌุนุงุช ุจุดูู ุตุญูุญ! ๐โจ 