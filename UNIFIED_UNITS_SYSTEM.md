# النظام الموحد لإدارة الوحدات - FoudaMarket

## نظرة عامة
تم تطوير نظام موحد لإدارة الوحدات الأساسية والإضافية في شاشة إضافة/تعديل المنتجات. هذا النظام يوفر تجربة مستخدم محسنة وتنظيم أفضل للبيانات.

## المميزات الجديدة

### 1. إدارة موحدة للوحدات
- **الوحدة الأساسية**: إدارة الوحدة الأساسية للمنتج (السعر، العرض، الكمية)
- **الوحدات الإضافية**: إدارة وحدات متعددة بسعر مختلف
- **واجهة موحدة**: تصميم متسق ومفهوم

### 2. تنظيم البيانات
- **UnifiedUnitsData**: فئة جديدة لتجميع بيانات الوحدات
- **إدارة الحالة**: تحديث فوري للبيانات
- **التحقق من الصحة**: تحقق شامل من البيانات المدخلة

### 3. تحسين رفع البيانات إلى Firebase
- **بيانات منظمة**: هيكل بيانات واضح ومنظم
- **تحديث فوري**: رفع البيانات مباشرة عند التغيير
- **دعم التحرير**: حفظ التغييرات في الوحدات الموجودة

## الملفات الجديدة والمحدثة

### ملفات جديدة:
- `lib/views/admin/widgets/unified_units_manager.dart` - النظام الموحد لإدارة الوحدات

### ملفات محدثة:
- `lib/views/admin/add_product_screen.dart` - دمج النظام الموحد
- `lib/views/admin/widgets/index.dart` - إضافة export للـ widget الجديد

## هيكل البيانات الجديد

### UnifiedUnitsData
```dart
class UnifiedUnitsData {
  final String baseUnit;           // اسم الوحدة الأساسية
  final double basePrice;          // سعر الوحدة الأساسية
  final double? baseOfferPrice;    // سعر العرض للوحدة الأساسية
  final int baseStock;             // الكمية المتوفرة للوحدة الأساسية
  final bool baseHasOffer;         // هل الوحدة الأساسية في عرض
  final bool baseIsActive;         // حالة تفعيل الوحدة الأساسية
  final List<ProductUnit> additionalUnits; // الوحدات الإضافية
}
```

### ProductUnit (محسن)
```dart
class ProductUnit {
  final String id;                 // معرف فريد
  final String name;               // اسم الوحدة
  final double price;              // السعر
  final double? originalPrice;     // السعر الأصلي (للعروض)
  final bool isSpecialOffer;       // هل في عرض خاص
  final int stockQuantity;         // الكمية المتوفرة
  final bool isActive;             // حالة التفعيل
}
```

## كيفية العمل

### 1. الوحدة الأساسية
- **إدارة شاملة**: اسم، سعر، عرض، كمية، حالة تفعيل
- **تصميم مميز**: خلفية زرقاء لتمييزها عن الوحدات الإضافية
- **تحقق من الصحة**: تحقق من صحة البيانات المدخلة

### 2. الوحدات الإضافية
- **إضافة ديناميكية**: إضافة وحدة جديدة بسهولة
- **تحرير مرن**: تعديل وحذف الوحدات
- **إدارة العروض**: عروض خاصة لكل وحدة

### 3. رفع البيانات
- **تحديث فوري**: رفع البيانات عند كل تغيير
- **حفظ منظم**: حفظ البيانات في Firebase بشكل منظم
- **دعم التحرير**: تحديث المنتجات الموجودة

## مثال على الاستخدام

### إضافة منتج جديد
```dart
// تهيئة البيانات الافتراضية
unitsData = UnifiedUnitsData(
  baseUnit: 'قطعة',
  basePrice: 0,
  baseStock: 0,
  baseHasOffer: false,
  baseIsActive: true,
  additionalUnits: [],
);

// استخدام UnifiedUnitsManager
UnifiedUnitsManager(
  initialBaseUnit: unitsData?.baseUnit,
  initialBasePrice: unitsData?.basePrice,
  initialBaseOfferPrice: unitsData?.baseOfferPrice,
  initialBaseStock: unitsData?.baseStock,
  initialBaseHasOffer: unitsData?.baseHasOffer,
  initialAdditionalUnits: unitsData?.additionalUnits,
  onUnitsChanged: (data) {
    setState(() {
      unitsData = data;
    });
  },
)
```

### تحرير منتج موجود
```dart
// تحميل البيانات الموجودة
unitsData = UnifiedUnitsData(
  baseUnit: product.unit,
  basePrice: product.price,
  baseOfferPrice: product.originalPrice,
  baseStock: product.stockQuantity,
  baseHasOffer: product.isSpecialOffer,
  baseIsActive: product.isActive,
  additionalUnits: product.units?.toList() ?? [],
);
```

## الفوائد

### 1. تجربة مستخدم محسنة
- **واجهة موحدة**: تصميم متسق ومفهوم
- **تنظيم أفضل**: فصل واضح بين الوحدة الأساسية والإضافية
- **سهولة الاستخدام**: إدارة بسيطة وواضحة

### 2. تنظيم البيانات
- **هيكل واضح**: بيانات منظمة ومفهومة
- **سهولة الصيانة**: كود منظم وقابل للصيانة
- **قابلية التوسع**: سهولة إضافة ميزات جديدة

### 3. تحسين الأداء
- **تحديث فوري**: استجابة سريعة للتغييرات
- **تحقق من الصحة**: تحقق فوري من البيانات
- **حفظ فعال**: رفع البيانات بشكل فعال

## التطوير المستقبلي

### 1. ميزات إضافية
- **صور مختلفة**: صور مختلفة لكل وحدة
- **خصومات نسبية**: خصومات بناءً على الكمية
- **وحدات مركبة**: وحدات تحتوي على وحدات فرعية

### 2. تحسينات تقنية
- **تحقق متقدم**: تحقق أكثر دقة من البيانات
- **أداء محسن**: تحسين سرعة التحديث
- **ذاكرة محسنة**: إدارة أفضل للذاكرة

### 3. تحسينات واجهة المستخدم
- **تصميم متجاوب**: تحسين التصميم للأجهزة المختلفة
- **رسوم متحركة**: إضافة رسوم متحركة للتفاعل
- **إمكانية الوصول**: تحسين إمكانية الوصول

## ملاحظات مهمة

### 1. التوافق
- **توافق كامل**: يعمل مع المنتجات الموجودة
- **ترقية سلسة**: لا يؤثر على البيانات الموجودة
- **دعم كامل**: دعم كامل للتحرير والإضافة

### 2. الأمان
- **تحقق من البيانات**: تحقق شامل من البيانات المدخلة
- **حماية من الأخطاء**: معالجة الأخطاء بشكل آمن
- **نسخ احتياطية**: حفظ البيانات بشكل آمن

### 3. الأداء
- **تحسين الذاكرة**: إدارة فعالة للذاكرة
- **سرعة الاستجابة**: استجابة سريعة للتغييرات
- **كفاءة الشبكة**: رفع البيانات بكفاءة 