# تحديث حالة التوفر للوحدات - FoudaMarket

## نظرة عامة
تم تحديث نظام إدارة الوحدات ليشمل حالة التوفر تحت كل وحدة (أساسية وإضافية)، مع إبقاء قسم "حالة التوفر" العام منفصلاً للتحكم في توفر المنتج ككل.

## التغييرات المطبقة

### 1. إضافة حالة التوفر تحت كل وحدة
- **الوحدة الأساسية**: إضافة switch "متوفر للبيع" تحت الكمية المتوفرة
- **الوحدات الإضافية**: إضافة switch "متوفر للبيع" تحت كل وحدة إضافية
- **تصميم موحد**: تصميم أخضر موحد لحالة التوفر

### 2. حذف switch من رأس الوحدة الأساسية
- **قبل التحديث**: switch في رأس الوحدة الأساسية
- **بعد التحديث**: switch محذوف من الرأس، موجود تحت الكمية

### 3. تنظيف واجهة الوحدات الإضافية
- **قبل التحديث**: switch وزر الحذف في الرأس
- **بعد التحديث**: زر الحذف فقط في الرأس، switch تحت الكمية

## الملفات المحدثة

### `lib/views/admin/widgets/unified_units_manager.dart`
- إضافة حالة التوفر تحت الوحدة الأساسية
- إضافة حالة التوفر تحت الوحدات الإضافية
- حذف switch من رأس الوحدة الأساسية
- تنظيف واجهة الوحدات الإضافية

## الفوائد

### 1. تنظيم أفضل
- **وضوح أكبر**: حالة التوفر واضحة تحت كل وحدة
- **تنظيم منطقي**: تجميع معلومات كل وحدة في مكان واحد
- **سهولة الاستخدام**: سهولة في تحديد حالة كل وحدة

### 2. مرونة أكبر
- **تحكم دقيق**: تحكم منفصل في توفر كل وحدة
- **إدارة شاملة**: إدارة كاملة لحالة كل وحدة
- **مرونة في البيع**: إمكانية إيقاف وحدة معينة عن البيع

### 3. تجربة مستخدم محسنة
- **واجهة نظيفة**: واجهة أكثر تنظيماً
- **سهولة الفهم**: سهولة في فهم حالة كل وحدة
- **تفاعل أفضل**: تفاعل أفضل مع الوحدات

## هيكل الوحدات الجديد

### الوحدة الأساسية:
1. **الرأس**: اسم الوحدة الأساسية (بدون switch)
2. **اسم الوحدة**: حقل إدخال اسم الوحدة
3. **السعر**: حقل إدخال السعر
4. **العرض الخاص**: switch وحقل سعر العرض
5. **الكمية المتوفرة**: حقل إدخال الكمية
6. **حالة التوفر**: switch "متوفر للبيع"

### الوحدات الإضافية:
1. **الرأس**: اسم الوحدة الإضافية + زر الحذف
2. **اسم الوحدة**: حقل إدخال اسم الوحدة
3. **السعر**: حقل إدخال السعر
4. **العرض الخاص**: switch وحقل سعر العرض
5. **الكمية المتوفرة**: حقل إدخال الكمية
6. **حالة التوفر**: switch "متوفر للبيع"

## مثال على التغيير

### قبل التحديث:
```dart
// رأس الوحدة الأساسية
Row(
  children: [
    Icon(Icons.star, color: Colors.blue[700], size: 20),
    Text('الوحدة الأساسية'),
    const Spacer(),
    Switch(value: baseIsActive, onChanged: (value) { ... }), // محذوف
  ],
),

// رأس الوحدة الإضافية
Row(
  children: [
    Text('الوحدة الإضافية ${index + 1}'),
    Switch(value: additionalIsActiveList[index], onChanged: (value) { ... }), // محذوف
    IconButton(onPressed: () => _removeAdditionalUnit(index), icon: Icon(Icons.delete)),
  ],
),
```

### بعد التحديث:
```dart
// رأس الوحدة الأساسية
Row(
  children: [
    Icon(Icons.star, color: Colors.blue[700], size: 20),
    Text('الوحدة الأساسية'),
  ],
),

// رأس الوحدة الإضافية
Row(
  children: [
    Text('الوحدة الإضافية ${index + 1}'),
    IconButton(onPressed: () => _removeAdditionalUnit(index), icon: Icon(Icons.delete)),
  ],
),

// حالة التوفر تحت كل وحدة
Container(
  padding: const EdgeInsets.all(12),
  decoration: BoxDecoration(
    color: Colors.green[50],
    borderRadius: BorderRadius.circular(8),
    border: Border.all(color: Colors.green[200]!),
  ),
  child: Row(
    children: [
      Switch(
        value: isActive,
        onChanged: (value) { ... },
        activeColor: Colors.green,
      ),
      Text('متوفر للبيع'),
    ],
  ),
),
```

## منطق الحفظ

### حفظ حالة التوفر:
```dart
// الوحدة الأساسية
final baseUnitData = UnifiedUnitsData(
  baseUnit: baseUnitController.text.trim(),
  basePrice: double.tryParse(basePriceController.text.trim()) ?? 0,
  baseOfferPrice: baseHasOffer ? double.tryParse(baseOfferPriceController.text.trim()) : null,
  baseStock: int.tryParse(baseStockController.text.trim()) ?? 0,
  baseHasOffer: baseHasOffer,
  baseIsActive: baseIsActive,  // حالة التوفر
  additionalUnits: additionalUnits,
);

// الوحدات الإضافية
additionalUnits[index] = additionalUnits[index].copyWith(
  name: name,
  price: price,
  originalPrice: offerPrice,
  isSpecialOffer: additionalHasOfferList[index],
  stockQuantity: stock,
  isActive: additionalIsActiveList[index],  // حالة التوفر
);
```

## ملاحظات مهمة

### 1. التوافق
- **توافق كامل**: لا يؤثر على المنتجات الموجودة
- **ترقية سلسة**: جميع البيانات محفوظة
- **دعم كامل**: دعم كامل للتحرير والإضافة

### 2. البيانات
- **حفظ حالة التوفر**: حالة التوفر محفوظة لكل وحدة
- **استرجاع البيانات**: يمكن استرجاع حالة التوفر عند التحرير
- **قيم افتراضية**: قيم افتراضية آمنة للمنتجات الجديدة

### 3. التحقق من الصحة
- **تحقق من التوفر**: التحقق من صحة حالة التوفر
- **تحقق من الكميات**: التحقق من صحة الكميات
- **تحقق شامل**: تحقق شامل من جميع البيانات

## التطوير المستقبلي

### 1. تحسينات إضافية
- **تنبيهات التوفر**: تنبيهات عند انخفاض الكمية
- **إحصائيات التوفر**: إحصائيات مفصلة لحالة التوفر
- **تقارير التوفر**: تقارير مفصلة لحالة التوفر

### 2. ميزات جديدة
- **توفر مؤقت**: توفر مؤقت لفترات محددة
- **توفر جغرافي**: توفر مختلف حسب المنطقة
- **توفر للعملاء**: توفر خاص لفئات معينة من العملاء 